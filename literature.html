<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 text-gray-800">
  <div class="max-w-2xl w-full mx-auto p-4 sm:p-6 bg-white rounded-2xl shadow-lg mt-6 sm:mt-10">
    <h1 class="text-2xl font-bold text-center mb-6 text-indigo-700">üéì –õ–∏—Ç–µ—Ä–∞—Ç—É—Ä–Ω–∞ –≤–∏–∫—Ç–æ—Ä–∏–Ω–∞</h1>

    <div id="question-container" class="space-y-4"></div>

    <div class="mt-6 flex justify-between items-center">
      <button id="check-answers" class="bg-indigo-600 hover:bg-indigo-700 text-white px-4 py-2 rounded-lg">
        –ü—Ä–æ–≤–µ—Ä–∏
      </button>
      <div>–¢–æ—á–∫–∏: <span id="current-score" class="font-semibold">0</span></div>
    </div>

    <!-- –ù–æ–≤ –±—É—Ç–æ–Ω "–ü—Ä–æ–¥—ä–ª–∂–∏" -->
    <div class="mt-4 text-center">
      <button id="next-question" class="hidden bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">
        –ü—Ä–æ–¥—ä–ª–∂–∏
      </button>
    </div>

    <div id="result-message" class="text-center mt-4 text-lg font-semibold hidden"></div>
  </div>

  <script>
  // –¢–∞–±–ª–∏—Ü–∞ —Å –¥–∞–Ω–Ω–∏ –æ—Ç Excel
  const literatureData = [
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ñ–µ–ª–µ–∑–Ω–∏—è—Ç —Å–≤–µ—Ç–∏–ª–Ω–∏–∫", "–ê–≤—Ç–æ—Ä": "–î–∏–º–∏—Ç—ä—Ä –¢–∞–ª–µ–≤", "–ñ–∞–Ω—Ä": "–†–æ–º–∞–Ω", "–¢–µ–º–∞": "–†–æ–¥–Ω–æ—Ç–æ –∏ —á—É–∂–¥–æ—Ç–æ", "–ì–µ—Ä–æ–∏": "–°—É–ª—Ç–∞–Ω–∞ –ì–ª–∞—É—à–µ–≤–∞, –õ–∞–∑–∞—Ä, –ö–∞—Ç–µ—Ä–∏–Ω–∞, –°—Ç–æ—è–Ω" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ë–∞–π –ì–∞–Ω—å–æ", "–ê–≤—Ç–æ—Ä": "–ê–ª–µ–∫–æ –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∏–Ω–æ–≤", "–ñ–∞–Ω—Ä": "–§–µ–π–ª–µ—Ç–æ–Ω", "–¢–µ–º–∞": "–†–æ–¥–Ω–æ—Ç–æ –∏ —á—É–∂–¥–æ—Ç–æ", "–ì–µ—Ä–æ–∏": "–ë–∞–π –ì–∞–Ω—å–æ, –ì–æ—á–æ–æ–ª—É, –î–æ—á–æ–æ–ª—É" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ë–∞–ª–∫–∞–Ω—Å–∫–∏ —Å–∏–Ω–¥—Ä–æ–º", "–ê–≤—Ç–æ—Ä": "–°—Ç–∞–Ω–∏—Å–ª–∞–≤ –°—Ç—Ä–∞—Ç–∏–µ–≤", "–ñ–∞–Ω—Ä": "–î—Ä–∞–º–∞", "–¢–µ–º–∞": "–†–æ–¥–Ω–æ—Ç–æ –∏ —á—É–∂–¥–æ—Ç–æ", "–ì–µ—Ä–æ–∏": "–î–∏—Ä–µ–∫—Ç–æ—Ä—ä—Ç, –ü–µ–ø–æ, –ü—Ä–æ—Ñ–µ—Å–æ—Ä—ä—Ç" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ü–∞–∏—Å–∏–π", "–ê–≤—Ç–æ—Ä": "–ò–≤–∞–Ω –í–∞–∑–æ–≤", "–ñ–∞–Ω—Ä": "–û–¥–∞", "–¢–µ–º–∞": "–ú–∏–Ω–∞–ª–æ—Ç–æ –∏ –ø–∞–º–µ—Ç—Ç–∞", "–ì–µ—Ä–æ–∏": "" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ò—Å—Ç–æ—Ä–∏—è", "–ê–≤—Ç–æ—Ä": "–ù–∏–∫–æ–ª–∞ –í–∞–ø—Ü–∞—Ä–æ–≤", "–ñ–∞–Ω—Ä": "–õ–∏—Ä–∏—á–µ—Å–∫–æ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ", "–¢–µ–º–∞": "–ú–∏–Ω–∞–ª–æ—Ç–æ –∏ –ø–∞–º–µ—Ç—Ç–∞", "–ì–µ—Ä–æ–∏": "" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ë–æ—Ä–±–∞", "–ê–≤—Ç–æ—Ä": "–•—Ä–∏—Å—Ç–æ –ë–æ—Ç–µ–≤", "–ñ–∞–Ω—Ä": "–°–æ—Ü–∏–∞–ª–Ω–æ-–ø–æ–ª–∏—Ç–∏—á–µ—Å–∫–æ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ", "–¢–µ–º–∞": "–û–±—â–µ—Å—Ç–≤–æ—Ç–æ –∏ –≤–ª–∞—Å—Ç—Ç–∞", "–ì–µ—Ä–æ–∏": "" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ê–Ω–¥—Ä–µ—à–∫–æ", "–ê–≤—Ç–æ—Ä": "–ï–ª–∏–Ω –ü–µ–ª–∏–Ω", "–ñ–∞–Ω—Ä": "–†–∞–∑–∫–∞–∑", "–¢–µ–º–∞": "–û–±—â–µ—Å—Ç–≤–æ—Ç–æ –∏ –≤–ª–∞—Å—Ç—Ç–∞", "–ì–µ—Ä–æ–∏": "–ê–Ω–¥—Ä–µ—à–∫–æ, –°—ä–¥–∏—è-–∏–∑–ø—ä–ª–Ω–∏—Ç–µ–ª—è" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ü—Ä–∏–∫–∞–∑–∫–∞ –∑–∞ —Å—Ç—ä–ª–±–∞—Ç–∞", "–ê–≤—Ç–æ—Ä": "–•—Ä–∏—Å—Ç–æ –°–º–∏—Ä–Ω–µ–Ω—Å–∫–∏", "–ñ–∞–Ω—Ä": "–°–∞—Ç–∏—Ä–∏—á–µ–Ω —Ä–∞–∑–∫–∞–∑", "–¢–µ–º–∞": "–û–±—â–µ—Å—Ç–≤–æ—Ç–æ –∏ –≤–ª–∞—Å—Ç—Ç–∞", "–ì–µ—Ä–æ–∏": "–ú–ª–∞–¥–∏—è—Ç –º–æ–º—ä–∫" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–î–æ –º–æ–µ—Ç–æ –ø—ä—Ä–≤–æ –ª–∏–±–µ", "–ê–≤—Ç–æ—Ä": "–•—Ä–∏—Å—Ç–æ –ë–æ—Ç–µ–≤", "–ñ–∞–Ω—Ä": "–õ–∏—Ä–∏—á–µ—Å–∫–æ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ", "–¢–µ–º–∞": "–ñ–∏–≤–æ—Ç—ä—Ç –∏ —Å–º—ä—Ä—Ç—Ç–∞", "–ì–µ—Ä–æ–∏": "" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ù–æ–≤–æ—Ç–æ –≥—Ä–æ–±–∏—â–µ –Ω–∞–¥ –°–ª–∏–≤–Ω–∏—Ü–∞", "–ê–≤—Ç–æ—Ä": "–ò–≤–∞–Ω –í–∞–∑–æ–≤", "–ñ–∞–Ω—Ä": "–õ–∏—Ä–∏—á–µ—Å–∫–æ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ", "–¢–µ–º–∞": "–ñ–∏–≤–æ—Ç—ä—Ç –∏ —Å–º—ä—Ä—Ç—Ç–∞", "–ì–µ—Ä–æ–∏": "" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ö—Ä–∞–¥–µ—Ü—ä—Ç –Ω–∞ –ø—Ä–∞—Å–∫–æ–≤–∏", "–ê–≤—Ç–æ—Ä": "–ï–º–∏–ª–∏—è–Ω –°—Ç–∞–Ω–µ–≤", "–ñ–∞–Ω—Ä": "–ü–æ–≤–µ—Å—Ç", "–¢–µ–º–∞": "–ñ–∏–≤–æ—Ç—ä—Ç –∏ —Å–º—ä—Ä—Ç—Ç–∞", "–ì–µ—Ä–æ–∏": "–ò–≤–æ, –ï–ª–∏—Å–∞–≤–µ—Ç–∞, –ü–æ–ª–∫–æ–≤–Ω–∏–∫—ä—Ç" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ü—Ä–∏ –†–∏–ª—Å–∫–∏—è –º–∞–Ω–∞—Å—Ç–∏—Ä", "–ê–≤—Ç–æ—Ä": "–ò–≤–∞–Ω –í–∞–∑–æ–≤", "–ñ–∞–Ω—Ä": "–õ–∏—Ä–∏—á–µ—Å–∫–æ —Å—Ç–∏—Ö–æ—Ç–≤–æ—Ä–µ–Ω–∏–µ", "–¢–µ–º–∞": "–ü—Ä–∏—Ä–æ–¥–∞—Ç–∞", "–ì–µ—Ä–æ–∏": "" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ì—Ä–∞–¥—É—à–∫–∞", "–ê–≤—Ç–æ—Ä": "–ü–µ–π–æ –Ø–≤–æ—Ä–æ–≤", "–ñ–∞–Ω—Ä": "–ü–æ–µ–º–∞", "–¢–µ–º–∞": "–ü—Ä–∏—Ä–æ–¥–∞—Ç–∞", "–ì–µ—Ä–æ–∏": "" },
    { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–°–ø–∏ –µ–∑–µ—Ä–æ—Ç–æ", "–ê–≤—Ç–æ—Ä": "–ü–µ–Ω—á–æ –°–ª–∞–≤–µ–π–∫–æ–≤", "–ñ–∞–Ω—Ä": "–õ–∏—Ä–∏—á–µ—Å–∫–∞ –º–∏–Ω–∏–∞—Ç—é—Ä–∞", "–¢–µ–º–∞": "–ü—Ä–∏—Ä–æ–¥–∞—Ç–∞", "–ì–µ—Ä–æ–∏": "" }
  ];

  const fields = ["–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ", "–ê–≤—Ç–æ—Ä", "–ñ–∞–Ω—Ä", "–¢–µ–º–∞", "–ì–µ—Ä–æ–π"];
  const fieldMap = { "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ": "–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ", "–ê–≤—Ç–æ—Ä": "–ê–≤—Ç–æ—Ä", "–ñ–∞–Ω—Ä": "–ñ–∞–Ω—Ä", "–¢–µ–º–∞": "–¢–µ–º–∞", "–ì–µ—Ä–æ–π": "–ì–µ—Ä–æ–∏" };
  let currentScore = 0;
  let usedCombos = new Set();
  let genreFrequency = {}, themeFrequency = {};

  function analyzeFrequencies() {
    genreFrequency = {}; themeFrequency = {};
    literatureData.forEach(i => {
      if (i["–ñ–∞–Ω—Ä"]) genreFrequency[i["–ñ–∞–Ω—Ä"]] = (genreFrequency[i["–ñ–∞–Ω—Ä"]] || 0) + 1;
      if (i["–¢–µ–º–∞"]) themeFrequency[i["–¢–µ–º–∞"]] = (themeFrequency[i["–¢–µ–º–∞"]] || 0) + 1;
    });
  }

  function normalize(text) {
    return text.toLowerCase().replace(/[‚Äû‚Äú"‚Äù'.,!?]/g, '').trim();
  }

  function startGame() {
    analyzeFrequencies();
    currentScore = 0;
    usedCombos.clear();
    document.getElementById("current-score").textContent = 0;
    nextRound();
  }

  function nextRound() {
    if (usedCombos.size === literatureData.length) {
      endGame();
      return;
    }

    let row;
    do {
      row = literatureData[Math.floor(Math.random() * literatureData.length)];
    } while (usedCombos.has(row["–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ"]) && usedCombos.size < literatureData.length);
    usedCombos.add(row["–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ"]);

    const container = document.getElementById("question-container");
    container.innerHTML = "";

    // –î–æ–±–∞–≤—è–º–µ –∫–∞–≤–∏—á–∫–∏ –Ω–∞ –ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ—Ç–æ
    if (row["–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ"] && !row["–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ"].startsWith("‚Äû")) {
      row["–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ"] = `‚Äû${row["–ü—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ"]}‚Äú`;
    }

    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∫–æ –ø—ä—Ç–∏ —Å–µ —Å—Ä–µ—â–∞ –∞–≤—Ç–æ—Ä—ä—Ç
    const authorCount = literatureData.filter(item => item["–ê–≤—Ç–æ—Ä"] === row["–ê–≤—Ç–æ—Ä"]).length;

    const available = [...fields];
    const rareFields = available.filter(f => {
      const real = fieldMap[f];
      if (real === "–ñ–∞–Ω—Ä" && genreFrequency[row["–ñ–∞–Ω—Ä"]] > 1) return false;
      if (real === "–¢–µ–º–∞" && themeFrequency[row["–¢–µ–º–∞"]] > 1) return false;
      return true;
    });

    const showFields = new Set();
    const pool = rareFields.length >= 2 ? rareFields : available;

    // –ê–∫–æ –∞–≤—Ç–æ—Ä—ä—Ç —Å–µ —Å—Ä–µ—â–∞ –ø–æ–≤–µ—á–µ –æ—Ç –≤–µ–¥–Ω—ä–∂, –ø–æ–∫–∞–∑–≤–∞–º–µ "–ê–≤—Ç–æ—Ä + –¢–µ–º–∞"
    if (authorCount > 1) {
      showFields.add("–ê–≤—Ç–æ—Ä");
      showFields.add("–¢–µ–º–∞");
    } else {
      // –ò–Ω–∞—á–µ —Å–ª—É—á–∞–π–Ω–æ 2 –æ—Ç –¥—Ä—É–≥–∏—Ç–µ
      while (showFields.size < 2) showFields.add(pool[Math.floor(Math.random() * pool.length)]);
    }

    fields.forEach(f => {
      const real = fieldMap[f];
      let value = row[real] || "";
      if (f === "–ì–µ—Ä–æ–π" && value) {
        const heroes = value.split(",").map(x => x.trim()).filter(x => x);
        if (heroes.length > 1) value = heroes[Math.floor(Math.random() * heroes.length)];
      }

      const div = document.createElement("div");
      div.className = "text-lg";
      div.innerHTML = `<strong>${f}:</strong> `;

      if (showFields.has(f)) {
        div.innerHTML += `<span class="text-indigo-700 font-medium">${value}</span>`;
      } else if (value) {
        div.innerHTML += `
          <input type="text" data-answer="${value}"
            class="border-b border-gray-400 focus:border-indigo-500 w-3/4 outline-none">
          <span class="text-sm text-gray-500 ml-2">(${f})</span>`;
      }
      container.appendChild(div);
    });

    document.getElementById("result-message").classList.add("hidden");
  }

  document.getElementById("check-answers").addEventListener("click", () => {
    const inputs = document.querySelectorAll("input[data-answer]");
    let correct = 0;

    inputs.forEach(inp => {
      const ans = normalize(inp.dataset.answer);
      const val = normalize(inp.value);

      const oldFeedback = inp.parentNode.querySelector(".correct-answer");
      if (oldFeedback) oldFeedback.remove();

      if (ans.includes(val) && val.length > 0) {
        inp.classList.add("border-green-500");
        inp.classList.remove("border-red-500");
        correct++;
      } else {
        inp.classList.add("border-red-500");
        inp.classList.remove("border-green-500");

        const correctEl = document.createElement("span");
        correctEl.className = "correct-answer text-green-600 ml-3";
        correctEl.textContent = `–í—è—Ä–Ω–æ: ${inp.dataset.answer}`;
        inp.parentNode.appendChild(correctEl);
      }
    });

    currentScore += correct;
    document.getElementById("current-score").textContent = currentScore;

    const msg = document.getElementById("result-message");
    msg.classList.remove("hidden");
    msg.textContent = correct === inputs.length
      ? "‚úÖ –í—Å–∏—á–∫–∏ –≤–µ—Ä–Ω–∏!"
      : `‚úî ${correct} –≤–µ—Ä–Ω–∏ –æ—Ç–≥–æ–≤–æ—Ä–∞. –í–∏–∂ –≤—è—Ä–Ω–∏—Ç–µ –æ—Ç–≥–æ–≤–æ—Ä–∏ –∏ –Ω–∞—Ç–∏—Å–Ω–∏ ‚Äû–ü—Ä–æ–¥—ä–ª–∂–∏‚Äú.`;

    document.getElementById("next-question").classList.remove("hidden");
  });

  document.getElementById("next-question").addEventListener("click", () => {
    document.getElementById("next-question").classList.add("hidden");
    nextRound();
  });

  function endGame() {
    alert(`–ò–≥—Ä–∞—Ç–∞ –ø—Ä–∏–∫–ª—é—á–∏! –¢–≤–æ—è—Ç —Ä–µ–∑—É–ª—Ç–∞—Ç –µ ${currentScore} —Ç–æ—á–∫–∏.`);
    startGame();
  }

  startGame();
  </script>
</body>
</html>
